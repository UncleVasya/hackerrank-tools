{% extends 'base.html' %}
{% load staticfiles %}

{% load filters %}

{% block page_scripts %}
    <script src="{% static 'games/js/base.js' %}"></script>
    <script src="{% static 'lifegame/visualizer.js' %}"></script>

    <!-- visualizer setup -->
    <script>
		$(document).ready(function() {
            var options = new Options();
            options.data_dir = '{% static 'lifegame/' %}';

            var container = document.getElementById('vis-container');
            var w = container.offsetWidth;
            var h = Math.min(window.innerHeight-50, container.offsetWidth);

            var visualizer = new VisApplication(container, options, w, h);
			visualizer.loadReplayData('{"status":["survived","survived"],"replaydata":{"ranking_turn":0,"cutoff":"turnlimitreached","engine_seed":1017212954,"map":{"rows":29,"data":["-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------","-----------------------------"],"cols":29},"bonus":[0,0],"turns":80,"cells":[[0,0,1,0],[1,0,2,1],[0,1,3,0],[1,2,4,1],[0,2,5,0],[2,0,6,1],[0,3,7,0],[1,3,8,1],[0,4,9,0],[3,0,10,1],[0,5,11,0],[1,1,12,1],[0,6,13,0],[1,7,14,1],[0,7,15,0],[2,3,16,1],[0,8,17,0],[3,2,18,1],[0,9,19,0],[1,4,20,1],[0,10,21,0],[2,2,22,1],[0,11,23,0],[4,3,24,1],[0,12,25,0],[4,0,26,1],[0,13,27,0],[4,2,28,1],[0,14,29,0],[0,15,30,1],[0,16,31,0],[5,2,32,1],[0,17,33,0],[2,1,34,1],[0,18,35,0],[0,19,36,1],[0,20,37,0],[0,21,38,1],[0,22,39,0],[1,10,40,1],[0,23,41,0],[1,16,42,1],[0,24,43,0],[4,4,44,1],[0,25,45,0],[1,25,46,1],[0,26,47,0],[0,27,48,1],[0,28,49,0],[2,26,50,1],[1,5,51,0],[2,6,52,1],[1,6,53,0],[6,1,54,1],[1,8,55,0],[2,4,56,1],[1,9,57,0],[1,23,58,1],[1,11,59,0],[3,4,60,1],[1,12,61,0],[5,0,62,1],[1,13,63,0],[5,5,64,1],[1,14,65,0],[3,5,66,1],[1,15,67,0],[3,26,68,1],[1,17,69,0],[6,5,70,1],[1,18,71,0],[2,19,72,1],[1,19,73,0],[6,2,74,1],[1,20,75,0],[4,1,76,1],[1,21,77,0],[7,4,78,1],[1,22,79,0],[7,0,80,1]],"loadtime":3000,"winning_turn":0,"players":2,"turntime":5000,"player_seed":-406592591,"scores":[[0],[0]],"revision":1},"challenge":"lifegame","rank":[1,0],"playerturns":[79,80],"score":[8,11],"replayformat":"json","location":"localhost","game_length":80,"game_id":0,"playernames":["SimpleBot.py","RandomBot.py"]}');
		});
	</script>

{% endblock page_scripts %}

{% block page_styles %}
    <link rel="stylesheet" href="{% static 'games/css/base.css' %}">
{% endblock page_styles %}

{% block content %}
    {% url 'games:match-overview' match.hk_id as match_url %}

    <div class="page-overview">
        <div class="page-overview-primary">
            <div class="page-overview-title">
                <h1>
                    Match {{ match.hk_id }}
                    <small>{% block player-page-title %}Overview{% endblock %}</small>
                </h1>
            </div>
        </div>

        <div class="page-overview-secondary">
            <dl>
                <dd>{{ match.game.name }}</dd>
                <dt>Game</dt>
            </dl>
            <dl>
                <dd>
                    <time class="timeago"
                          datetime="{{ match.date|date:'c' }}"
                          title="{{ match.date }}">
                    </time>
                </dd>
                <dt>Match played</dt>
            </dl>
        </div>
    </div>

    <div class="match-result">
        {% if match.result == 0 %}
            <div class="draw">Draw</div>
        {% elif match.result == 1 %}
            <div class="player1">{{ match.opponent_set.all.0.bot.player.name }} Victory</div>
        {% else %}
            <div class="player2">{{ match.opponent_set.all.1.bot.player.name }} Victory</div>
        {% endif %}
    </div>

    <div class="row">
    {% for opponent in match.opponent_set.all %}
        {% url 'games:player-overview' opponent.bot.player.name as player_url %}

        <div class="col-md-6">
            <section class="match-opponent player{{ forloop.counter }}">
                <header>
                    <a href="{{ player_url }}">
                        {{ opponent.bot.player.name }}
                    </a>
                    <div class="subtext">
                        {{ opponent.bot.player.country }}
                    </div>
                </header>
                <article>
                    <div class="avatar">
                        <a href="{{ player_url }}">
                            <img src="{{ opponent.bot.player.avatar }}">
                        </a>
                    </div>

                    <div class="table-responsive match-opponent-stats">
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <td class="col-md-3">Rank</td>
                                    <td class="col-md-2">
                                        {{ opponent.bot.rank }}
                                    </td>
                                    <td>
                                        <div class="color-bar">
                                            <div class="player{{ forloop.counter }}" style="width: {{ opponent.bot.rank_percent }}%"></div>
                                            <div style="width:{{ opponent.bot.rank_percent|remaining }}%"></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Score</td>
                                    <td>
                                        {{ opponent.bot.score|floatformat:2 }}
                                    </td>
                                    <td>
                                        <div class="color-bar">
                                            <div class="player{{ forloop.counter }}" style="width: {{ opponent.bot.score_percent }}%"></div>
                                            <div style="width:{{ opponent.bot.score_percent|remaining }}%"></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Language</td>
                                    <td colspan="2">{{ opponent.bot.language }}</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </article>
            </section>
        </div>
    {% endfor %}
    </div>

    <div class="replay-caption">Replay</div>
    <div id="vis-container"></div>
{% endblock %} <!-- content -->